import"./core-js.f60a8021.js";function l(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(e){return typeof e}:l=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(u)}function k(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function v(u,a){for(var e=0;e<a.length;e++){var r=a[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function d(u,a,e){return a&&v(u.prototype,a),e&&v(u,e),u}var y=function(){function u(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.localStorage;k(this,u),this.storage=window.localStorage,this.namespace="pro_",this.storage=a}return d(u,[{key:"config",value:function(e){if(e===!1){this.namespace="";return}e&&(this.namespace=e)}},{key:"clearStorage",value:function(e){var r={errMsg:"clearStorage:ok"};if(e){var t=e.success,n=e.fail,s=e.complete;try{this.clearStorageSync(),t&&t(r),s&&s(r)}catch{var o={errMsg:"clearStorage:fail"};return n&&n(o),s&&s(o),Promise.reject(o)}}return Promise.resolve(r)}},{key:"clearStorageSync",value:function(){for(var e=[],r=0;r<this.storage.length;r++){var t=this.storage.key(r);if(!!t){var n=new RegExp("^".concat(this.namespace,".+"),"i");!n.test(t)||e.push(t)}}for(var s in e)this.storage.removeItem(e[s])}},{key:"getStorage",value:function(e){var r=e.key,t=e.success,n=e.fail,s=e.complete,o={errMsg:"getStorage:ok"},i={errMsg:"getStorage:ok",data:""},f=this.getItem(r),S=f.result,m=f.data;if(S){var h=m;i.data=h.value}else return o.errMsg="getStorage:fail data not found",n&&n(o),s&&s(o),Promise.reject(o);return t&&t(i),s&&s(i),Promise.resolve(i)}},{key:"getStorageInfo",value:function(e){var r={errMsg:"getStorageInfo:ok"};if(e){var t=e.success,n=e.complete,s=e.fail;try{var o=this.getStorageInfoSync();t&&t(o),n&&n(r)}catch{s&&s(r),n&&n(r)}}return Promise.resolve(r)}},{key:"getStorageInfoSync",value:function(){return{keys:Object.keys(this.storage),limitSize:0,currentSize:0,keysLength:this.storage.length}}},{key:"hasKey",value:function(e){var r=this.getItem(e);return r.result}},{key:"isExpire",value:function(e){var r=this.getItem(e);if(r.result){var t=r.data;return t.expire===null?!1:t.expire<new Date().getTime()}return!1}},{key:"key",value:function(e){return this.storage.key(e)}},{key:"removeStorage",value:function(e){var r=e.key,t=e.success,n=e.fail,s=e.complete,o={errMsg:"removeStorage:ok"};return this.hasKey(r)?(this.removeStorageSync(r),t&&t(o),s&&s(o),Promise.resolve(o)):(o.errMsg="key ".concat(r," not exists !"),n&&n(o),s&&s(o),Promise.reject(o))}},{key:"removeStorageSync",value:function(e){return this.storage.removeItem(this.getItemKey(e))}},{key:"setStorage",value:function(e){var r=e.key,t=e.data,n=e.success,s=e.fail,o=e.complete,i={errMsg:"setStorage:ok"};try{return this.setStorageSync(r,t),this.hasKey(r)?(n&&n(i),o&&o(i),Promise.resolve(i)):(i.errMsg="key ".concat(r," setStorage2:fail"),s&&s(i),o&&o(i),Promise.reject(i))}catch{return i.errMsg="key ".concat(r," setStorage:fail"),s&&s(i),o&&o(i),Promise.reject(i)}}},{key:"setStorageSync",value:function(e,r,t){var n={value:r,expire:t?new Date().getTime()+t:null},s=JSON.stringify(n);this.storage.setItem(this.getItemKey(e),s)}},{key:"getItemKey",value:function(e){return this.namespace+e}},{key:"getItem",value:function(e){try{var r,t=this.storage.getItem(this.getItemKey(e));if(t!==null&&(r=JSON.parse(t)),r&&l(r)==="object"&&"expire"in r&&"value"in r)return{result:!0,data:r}}catch{return{result:!1}}return{result:!1}}},{key:"getStorageSync",value:function(e){var r=this.getItem(e);if(r.result){var t=r.data;if(!this.isExpire(e))return t.value}}}]),u}(),g;(function(u){u.Session="session",u.Local="local",u.WebSQL="webSQL",u.IndexDB="indexDB"})(g||(g={}));var c=new y,I={install:function(a,e){var r,t={storage:(e==null?void 0:e.storage)||g.Local,namespace:(r=e==null?void 0:e.namespace)!==null&&r!==void 0?r:"pro_"};if(typeof window=="undefined")throw new Error('Vue3Storage: Storage "'.concat(t.storage,'" is not supported'));var n;switch(t.storage){case g.Local:n=window.localStorage;break;case g.Session:n=window.sessionStorage;break;default:throw new Error('Vue3Storage: Storage "'.concat(t.storage,'" is not supported yet'))}c=new y(n),c.config(t.namespace),a.config.globalProperties.$storage=c}},b=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return c.config(a),c};export{I as V,b as u};
