<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energía mecánica</title>
    <style>
        *{padding:0; margin: 0;}
        html, body{height: 100%;}
        body{
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js" integrity="sha512-NxocnqsXP3zm0Xb42zqVMvjQIktKEpTIbCXXyhBPxqGZHqhcOXHs4pXI/GoZ8lE+2NJONRifuBpi9DxC58L0Lw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
// Spring drawing constants for top bar
let springHeight = 32,
    left,
    right,
    maxHeight = 200,
    minHeight = 100,
    over = false,
    move = false;

// Spring simulation constants
let M = 0.8,  // Mass
    K = 0.2,  // Spring constant
    D = 0.9, // Damping
    R = 150;  // Rest position

// Spring simulation variables
let ps = R,   // Position
    vs = 0.0, // Velocity
    as = 0,   // Acceleration
    f = 0;    // Force

function setup() {
  createCanvas(300, 300);
  rectMode(CORNERS);
  noStroke();
  left = width / 2 - 100;
  right = width / 2 + 100;
}

function draw() {
  background('#3e4451');
  updateSpring();
  drawSpring();

}

function springMult(dinaY, dinaYDiv, numb){
  return dinaY+dinaYDiv*numb
}

function drawSpring() {
  // Draw base
  fill(0.2);
  let baseWidth = 0.5 * ps + -8;
  fill(230)
  
  line(width/2 - baseWidth)

  var rectX = width / 2 - baseWidth
  var rectY = ps + springHeight
  var rectW = width / 2 + baseWidth
  var rectH = height


  //rect(rectX, rectY, rectW, rectH, 10, 10 , 0, );
  
  strokeWeight(20);
  let strokeDark = 20
  let strokeLight = 4
  let springDark = color(200,204,228);
  let springDark2 = color(190,194,208);
  let springLight = color(240,244,255, 100);

  let dinaY = rectH-Math.round(rectH - rectY)
  
  let dinaYDiv = Math.round((rectH - dinaY)/9)
  


  strokeWeight(strokeDark);
  
  stroke(springDark2);
  line(rectX, springMult(dinaY, dinaYDiv, 1) , rectW, springMult(dinaY, dinaYDiv, 0));
  for(var i in [0,1,2,3]){
    strokeWeight(strokeDark);
    stroke(springDark);
    line(rectX, springMult(dinaY, dinaYDiv, 1+(i*2)) , rectW, springMult(dinaY, dinaYDiv, 2+(i*2)));
    stroke(springDark2);
    line(rectX, springMult(dinaY, dinaYDiv, 3+(i*2)) , rectW, springMult(dinaY, dinaYDiv, 2+(i*2)));
    //Light
    stroke(springLight);
    strokeWeight(strokeLight);
    line(rectX, springMult(dinaY-5, dinaYDiv, 1+(i*2)) , rectW, springMult(dinaY, dinaYDiv, 2+(i*2))-5);
    line(rectX, springMult(dinaY-5, dinaYDiv, 3+(i*2)) , rectW, springMult(dinaY, dinaYDiv, 2+(i*2))-5);
  }
  noStroke()




  // Set color and draw top bar
  if (over || move) {
    fill('#b6c62c');
  } else {
    fill('#94a71a');
  }

  rect(left, ps, right, ps + springHeight, 7);
  fill(255,255,255,50);
  rect(left, ps, right, ps + springHeight-20, 40);
  fill(0,0,0,50);
  rect(left, ps+20, right, ps + springHeight, 40);
  //Forcebar
  fill(200)
  text('Energía potencial ', 20, 30);
  fill(50)
  rect(20, 50, 280, 40)
  fill('#fe5f58')
  var fuerza = Math.round(-(R-ps))
  if(fuerza>0){
    rect(20, 50, 30+fuerza*5, 40)
} else {
    rect(20, 50, 30+(-fuerza)*5, 40)
}
}

function updateSpring() {
  // Update the spring position
  if ( !move ) {
    f = -K * ( ps - R ); // f=-ky
    as = f / M;          // Set the acceleration, f=ma == a=f/m
    vs = D * (vs + as);  // Set the velocity
    ps = ps + vs;        // Updated position
  }

  if (abs(vs) < 0.1) {
    vs = 0.0;
  }

  // Test if mouse if over the top bar
  if (mouseX > left && mouseX < right && mouseY > ps && mouseY < ps + springHeight) {
    over = true;
  } else {
    over = false;
  }

  // Set and constrain the position of top bar
  if (move) {
    ps = mouseY - springHeight / 2;
    ps = constrain(ps, minHeight, maxHeight);
  }
}

function mousePressed() {
  if (over) {
    move = true;
  }
}

function mouseReleased() {
  move = false;
}


    </script>
</body>
</html>